<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Iaido Flashcards</title>
  <style>
    :root { --bg:#0b0c10; --card:#111318; --muted:#9aa3b2; --text:#eef2ff; --border:#242836; }
    *{ box-sizing:border-box; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body{ margin:0; background:linear-gradient(180deg,#0b0c10,#07080b); color:var(--text); }
    .wrap{ max-width:900px; margin:0 auto; padding:18px; }
    h1{ margin:6px 0 2px; font-size:22px; letter-spacing:.2px; }
    .sub{ color:var(--muted); font-size:13px; margin:0 0 14px; }
    .bar{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin:12px 0 14px; }
    select,input,button{
      background:#0f1117; color:var(--text); border:1px solid var(--border);
      border-radius:12px; padding:10px 12px; font-size:14px;
    }
    input{ min-width:220px; flex:1; }
    button{ cursor:pointer; }
    button:hover{ border-color:#3a4060; }
    .pill{ display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border:1px solid var(--border); border-radius:999px; color:var(--muted); font-size:12px; }
    .row{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin:10px 0; }
    .card{
      background:radial-gradient(1200px 600px at 20% 0%, #161a25, var(--card));
      border:1px solid var(--border); border-radius:18px; padding:18px;
      min-height:180px; display:flex; flex-direction:column; justify-content:space-between;
    }
    .face{ color:var(--muted); font-size:11px; letter-spacing:.7px; }
    .big{ font-size:26px; line-height:1.25; margin:10px 0 14px; }
    .hint{ color:var(--muted); font-size:12px; }
    .nav{ display:flex; gap:10px; }
    .rate{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:12px; }
    .rate button{ padding:12px 10px; font-weight:600; }
    .rate button:disabled{ opacity:.45; cursor:not-allowed; }
    .tiny{ color:var(--muted); font-size:12px; text-align:center; margin-top:8px;}
    .list{
      margin-top:16px; border:1px solid var(--border); border-radius:18px; overflow:hidden;
      background:#0f1117;
    }
    .list h2{ font-size:14px; margin:0; padding:12px 14px; border-bottom:1px solid var(--border); }
    .item{ padding:12px 14px; border-bottom:1px solid var(--border); }
    .item:last-child{ border-bottom:0; }
    .item b{ display:block; margin-bottom:4px; }
    .muted{ color:var(--muted); }
    .progress{ height:10px; background:#0f1117; border:1px solid var(--border); border-radius:999px; overflow:hidden; }
    .progress > div{ height:100%; background:#6d7cff; width:0%; }
    .kbd{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; padding:2px 6px; border:1px solid var(--border); border-radius:8px; color:var(--muted); }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Iaido Flashcards</h1>
    <p class="sub">Один файл. Работает офлайн. <span class="kbd">Space</span>/<span class="kbd">Enter</span> — перевернуть, <span class="kbd">←</span>/<span class="kbd">→</span> — навигация.</p>

    <div class="bar">
        <select id="lang">
  <option value="ru">RU</option>
  <option value="en">EN</option>
</select>
      <select id="deck"></select>
      <select id="mode">
        <option value="study">Study</option>
        <option value="quiz">Quiz</option>
      </select>
      <input id="search" placeholder="Поиск: mae, zanshin, tsuki…" />
      <button id="shuffle">Shuffle</button>
      <button id="reset">Reset</button>
    </div>

    <div class="row">
      <div class="pill" id="meta"></div>
      <div class="pill" id="score"></div>
    </div>

    <div class="progress" aria-label="Progress"><div id="prog"></div></div>

    <div class="row" style="margin-top:12px;">
      <div class="nav">
        <button id="prev">←</button>
        <button id="next">→</button>
      </div>
      <div class="pill muted" id="counter"></div>
    </div>

    <div class="card" id="card" role="button" tabindex="0" aria-label="Flashcard">
      <div>
        <div class="face" id="face">ЛИЦЕВАЯ</div>
        <div class="big" id="text">—</div>
      </div>
      <div class="hint" id="hint">Нажми карточку, чтобы перевернуть</div>
    </div>

    <div class="rate">
      <button id="again" disabled>Again (1)</button>
      <button id="hard" disabled>Hard (2)</button>
      <button id="good" disabled>Good (3)</button>
    </div>
    <div class="tiny">Оценка доступна после переворота. В Quiz: Hard/Good = «верно», Again = «неверно».</div>

    <div class="list">
      <h2>Справочник (вся колода)</h2>
      <div id="list"></div>
    </div>
  </div>

<script>
(function(){
  // --- language (must be inside IIFE) ---
  let lang = localStorage.getItem("iaido_lang") || "ru";

  // --- data ---
  const decks = {
    seitei: {
      name: { ru: "Seitei Iaido — 12 ката", en: "Seitei Iaido — 12 Kata" },
      cards: [
        { front:{ru:"Ipponme Mae",en:"Ipponme Mae"}, back:{ru:"1-я форма — Mae = «вперёд / перед». Противник спереди.", en:"First form — Mae = “front / forward”. Opponent in front."}},
        { front:{ru:"Nihonme Ushiro",en:"Nihonme Ushiro"}, back:{ru:"2-я форма — Ushiro = «назад». Противник атакует сзади.", en:"Second form — Ushiro = “rear / behind”. Opponent attacks from behind."}},
        { front:{ru:"Sanbonme Uke Nagashi",en:"Sanbonme Uke Nagashi"}, back:{ru:"3-я форма — «принять и отвести атаку». Контроль тайминга.", en:"Third form — “receive and deflect”. Timing and blade control."}},
        { front:{ru:"Yonhonme Tsuka Ate",en:"Yonhonme Tsuka Ate"}, back:{ru:"4-я форма — «удар рукоятью». Противники спереди и сзади.", en:"Fourth form — “strike with the hilt”. Enemies front and rear."}},
        { front:{ru:"Gohonme Kesa Giri",en:"Gohonme Kesa Giri"}, back:{ru:"5-я форма — «диагональный рез». Работа корпуса и ног.", en:"Fifth form — “diagonal cut”. Body movement and footwork."}},
        { front:{ru:"Ropponme Morote Tsuki",en:"Ropponme Morote Tsuki"}, back:{ru:"6-я форма — «укол двумя руками». Чёткое ki–ken–tai–ichi.", en:"Sixth form — “two-handed thrust”. Clear ki–ken–tai–ichi."}},
        { front:{ru:"Nanahonme Sanpō Giri",en:"Nanahonme Sanpō Giri"}, back:{ru:"7-я форма — «резы в трёх направлениях». Контроль пространства.", en:"Seventh form — “cuts in three directions”. Spatial awareness."}},
        { front:{ru:"Hachihonme Ganmen Ate",en:"Hachihonme Ganmen Ate"}, back:{ru:"8-я форма — «удар в лицо». Точный metsuke и дистанция.", en:"Eighth form — “strike to the face”. Accurate metsuke and maai."}},
        { front:{ru:"Kyūhonme Sōete Tsuki",en:"Kyūhonme Sōete Tsuki"}, back:{ru:"9-я форма — «укол с поддержкой руки». Контроль клинка.", en:"Ninth form — “supported thrust”. Blade control and precision."}},
        { front:{ru:"Jūpponme Shiho Giri",en:"Jūpponme Shiho Giri"}, back:{ru:"10-я форма — «резы в четырёх направлениях». Контроль центра.", en:"Tenth form — “cuts in four directions”. Center control."}},
        { front:{ru:"Jūipponme Sō Giri",en:"Jūipponme Sō Giri"}, back:{ru:"11-я форма — «последовательный рез». Непрерывность движений.", en:"Eleventh form — “continuous cuts”. Continuous flow."}},
        { front:{ru:"Jūnihonme Nuki Uchi",en:"Jūnihonme Nuki Uchi"}, back:{ru:"12-я форма — «мгновенное извлечение и удар». Минимум движений.", en:"Twelfth form — “draw and strike”. Immediate decisive action."}},
      ]
    },

    terms: {
      name: { ru: "Основные термины иайдо", en: "Core Iaido Terms" },
      cards: [
        { front:{ru:"Reiho",en:"Reiho"}, back:{ru:"Этикет и установленный порядок поклонов и процедур в иайдо.", en:"Etiquette and prescribed manners in Iaido."}},
        { front:{ru:"Saho",en:"Saho"}, back:{ru:"Правильное поведение в додзё и обращение с мечом.", en:"Correct behavior and procedures in the dojo."}},
        { front:{ru:"Zanshin",en:"Zanshin"}, back:{ru:"Сохраняемая готовность и осознанность после завершения техники.", en:"Remaining awareness and readiness after completing a technique."}},
        { front:{ru:"Metsuke",en:"Metsuke"}, back:{ru:"Постановка взгляда с контролем всего пространства.", en:"Use of the eyes to maintain awareness of the whole situation."}},
        { front:{ru:"Tenouchi",en:"Tenouchi"}, back:{ru:"Правильная работа кистей при резе: контроль и фиксация.", en:"Proper use of the hands and grip during cutting."}},
        { front:{ru:"Ki–Ken–Tai–Ichi",en:"Ki–Ken–Tai–Ichi"}, back:{ru:"Единство духа, меча и тела в одном действии.", en:"Unity of spirit, sword, and body in a single action."}},
        { front:{ru:"Jo–Ha–Kyu",en:"Jo–Ha–Kyu"}, back:{ru:"Принцип ритма: начало, развитие и быстрое завершение.", en:"Principle of rhythm: beginning, development, and rapid conclusion."}},
        { front:{ru:"Hasuji",en:"Hasuji"}, back:{ru:"Правильное направление лезвия при выполнении реза.", en:"Correct blade angle and alignment during a cut."}},
        { front:{ru:"Nukitsuke",en:"Nukitsuke"}, back:{ru:"Режущее действие, выполняемое при извлечении меча.", en:"Cut performed simultaneously with drawing the sword."}},
        { front:{ru:"Furi-kaburi",en:"Furi-kaburi"}, back:{ru:"Подъём меча над головой для подготовки основного удара.", en:"Raising the sword overhead in preparation for the main cut."}},
        { front:{ru:"Kiri-oroshi",en:"Kiri-oroshi"}, back:{ru:"Вертикальный рубящий удар сверху вниз.", en:"Vertical downward cut."}},
        { front:{ru:"Kesa-giri",en:"Kesa-giri"}, back:{ru:"Диагональный рез от плеча к противоположному бедру.", en:"Diagonal cut from shoulder to opposite hip."}},
        { front:{ru:"Chiburi",en:"Chiburi"}, back:{ru:"Символическое движение очищения клинка после удара.", en:"Symbolic motion representing cleaning blood from the blade."}},
        { front:{ru:"Noto",en:"Noto"}, back:{ru:"Контролируемое и безопасное возвращение меча в ножны.", en:"Controlled and safe resheathing of the sword."}},
        { front:{ru:"Saya-biki",en:"Saya-biki"}, back:{ru:"Оттягивание ножен назад левой рукой при извлечении.", en:"Pulling the scabbard back with the left hand while drawing."}},
      ]
    }
  };

  // --- state ---
  let deckKey = localStorage.getItem("iaido_deck") || "seitei";
  let mode = localStorage.getItem("iaido_mode") || "study";
  let search = "";
  let order = [];
  let idx = 0;
  let flipped = false;
  let score = { correct: 0, total: 0 };

  // --- dom ---
  const $lang = document.getElementById("lang");
  const $deck = document.getElementById("deck");
  const $mode = document.getElementById("mode");
  const $search = document.getElementById("search");
  const $shuffle = document.getElementById("shuffle");
  const $reset = document.getElementById("reset");
  const $prev = document.getElementById("prev");
  const $next = document.getElementById("next");
  const $card = document.getElementById("card");
  const $face = document.getElementById("face");
  const $text = document.getElementById("text");
  const $hint = document.getElementById("hint");
  const $meta = document.getElementById("meta");
  const $score = document.getElementById("score");
  const $counter = document.getElementById("counter");
  const $prog = document.getElementById("prog");
  const $list = document.getElementById("list");
  const $again = document.getElementById("again");
  const $hard = document.getElementById("hard");
  const $good = document.getElementById("good");

  // init selects
  $lang.value = lang;
  $mode.value = mode;

  function rebuildDeckSelect(){
    $deck.innerHTML = Object.keys(decks)
      .map(k => `<option value="${k}">${decks[k].name[lang]}</option>`)
      .join("");
    $deck.value = deckKey;
  }

  function currentDeck(){ return decks[deckKey]; }

  function filteredCards(){
    const q = search.trim().toLowerCase();
    const cards = currentDeck().cards.map((c,i)=>({...c, id: deckKey+":"+i}));
    return cards.filter(c =>
      !q ||
      c.front[lang].toLowerCase().includes(q) ||
      c.back[lang].toLowerCase().includes(q)
    );
  }

  function rebuild(shuf=false){
    const cards = filteredCards();
    order = cards.slice();
    if (shuf) order.sort(()=>Math.random()-0.5);
    idx = 0;
    flipped = false;
    score = {correct:0,total:0};
    render();
    renderList();
  }

  function render(){
    const total = order.length;

    $meta.textContent = `Колода: ${currentDeck().name[lang]}`;
    $score.textContent = mode === "quiz"
      ? `Счёт: ${score.correct}/${score.total}${score.total?` (${Math.round(score.correct/score.total*100)}%)`:""}`
      : `Режим: Study`;

    if (!total){
      $face.textContent = "—";
      $text.textContent = (lang === "ru") ? "Нет карточек. Очисти поиск." : "No cards. Clear the search.";
      $hint.textContent = "";
      $counter.textContent = "0/0";
      $prog.style.width = "0%";
      $again.disabled = $hard.disabled = $good.disabled = true;
      $prev.disabled = $next.disabled = true;
      return;
    }

    const card = order[idx];
    $face.textContent = flipped ? ((lang==="ru")?"ОБРАТНАЯ":"BACK") : ((lang==="ru")?"ЛИЦЕВАЯ":"FRONT");
    $text.textContent = flipped ? card.back[lang] : card.front[lang];
    $hint.textContent = (lang==="ru") ? "Нажми карточку, чтобы перевернуть" : "Click the card to flip";
    $counter.textContent = `${idx+1}/${total}`;
    $prog.style.width = `${Math.round((idx+1)/total*100)}%`;

    $prev.disabled = idx===0;
    $next.disabled = idx===total-1;

    const dis = !flipped;
    $again.disabled = dis; $hard.disabled = dis; $good.disabled = dis;
  }

  function renderList(){
    const cards = filteredCards();
    $list.innerHTML = cards.map(c => `
      <div class="item">
        <b>${c.front[lang]}</b>
        <div class="muted">${c.back[lang]}</div>
      </div>
    `).join("");
  }

  function flip(){ flipped = !flipped; render(); }
  function next(){ if (idx < order.length-1){ idx++; flipped=false; render(); } }
  function prev(){ if (idx > 0){ idx--; flipped=false; render(); } }

  function rate(kind){
    if (!order.length) return;
    if (mode === "quiz"){
      score.total += 1;
      if (kind !== "again") score.correct += 1;
      $score.textContent = `Счёт: ${score.correct}/${score.total} (${Math.round(score.correct/score.total*100)}%)`;
    }
    next();
  }

  // events
  $lang.addEventListener("change", e => {
    lang = e.target.value;
    localStorage.setItem("iaido_lang", lang);
    rebuildDeckSelect();
    rebuild(mode==="quiz");
  });

  $deck.addEventListener("change", e=>{
    deckKey = e.target.value;
    localStorage.setItem("iaido_deck", deckKey);
    rebuild(mode==="quiz");
  });

  $mode.addEventListener("change", e=>{
    mode = e.target.value;
    localStorage.setItem("iaido_mode", mode);
    rebuild(mode==="quiz");
  });

  $search.addEventListener("input", e=>{
    search = e.target.value;
    rebuild(mode==="quiz");
  });

  $shuffle.addEventListener("click", ()=> rebuild(true));
  $reset.addEventListener("click", ()=> { search=""; $search.value=""; rebuild(mode==="quiz"); });

  $prev.addEventListener("click", prev);
  $next.addEventListener("click", next);

  $card.addEventListener("click", flip);
  $card.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); flip(); } });

  $again.addEventListener("click", ()=>rate("again"));
  $hard.addEventListener("click", ()=>rate("hard"));
  $good.addEventListener("click", ()=>rate("good"));

  window.addEventListener("keydown", (e)=>{
    if (e.key==="ArrowRight") next();
    if (e.key==="ArrowLeft") prev();
    if (e.key===" " || e.key==="Enter"){ e.preventDefault(); flip(); }
    if (e.key==="1") rate("again");
    if (e.key==="2") rate("hard");
    if (e.key==="3") rate("good");
  });

  // start
  rebuildDeckSelect();
  rebuild(mode==="quiz");
})();
</script>

</body>
</html>
